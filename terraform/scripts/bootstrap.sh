#! /bin/bash

# Create user e91user
useradd  e91user --create-home --shell /bin/bash

# As a user root, create .ssh folder for e91user
mkdir /home/e91user/.ssh

# Insert the public key for TA
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC60rCTYzWNayyBzDaGfurLhCq5n1gqMc6MdPVkEobTTcf/aCb/EEGowqVmWg6xuD1o0biASsljK62cr+S00OYFgi1hKIVycyaTRsp2I7C5CTpfhh+ylGLHHJXk05dilz/YF6PcsmK3Rbh8NFS/s3qaeRkCcFgXa7zZV/3tjmSb+mCW673m2MJfJueT5+OIHVV6BMjzuM84TunX9ayUmMudXqQ7K/G2+bFueuaTa9lwER3618w+SQWx0FGuE9bDv1iqFpVfWXF2pd/4z+CK/j2S4ABAZ0MlZd+zMxHBm4G03mbKCuZ8mnj8v0kN41rg+3+AzMwGNiE2nx+TEZTsrJXX > /home/e91user/.ssh/authorized_keys

cat > /home/e91user/.ssh/id_rsa << EOF
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAutR0sHoCZDA0qmCUXukbrmwvFxCaPspsMfxBq79MoOmAUOmHmXwH
ssFK6r/Ac3irTQORDkGOcztiXl5MQ5LR6fw+KuPj/UPcUmuAi8u1tT8rzK/f2L6nOQzvKl
Dw0wMpU5siJ5DximgSLtXpy3yU+SuPHzWvO23nGGRWiqSQOUrDYVZIAIrXPG8+0Kx7NH0d
FNnYtBoabOChJUx8njKmDyag22+1zL1RozzPhXnUE3lf4Iq2To7QTGNbwC2Uhhtsc73RJx
Z09zlrfIQepj5kM8ahrXUz5pf5ZX3JO/edWSDubTqfzbRnHyuwrFREbiLkVOfaYpe5slTD
wJbCmzmrNwAAA9jvC9ol7wvaJQAAAAdzc2gtcnNhAAABAQC61HSwegJkMDSqYJRe6RuubC
8XEJo+ymwx/EGrv0yg6YBQ6YeZfAeywUrqv8BzeKtNA5EOQY5zO2JeXkxDktHp/D4q4+P9
Q9xSa4CLy7W1PyvMr9/Yvqc5DO8qUPDTAylTmyInkPGKaBIu1enLfJT5K48fNa87becYZF
aKpJA5SsNhVkgAitc8bz7QrHs0fR0U2di0Ghps4KElTHyeMqYPJqDbb7XMvVGjPM+FedQT
eV/girZOjtBMY1vALZSGG2xzvdEnFnT3OWt8hB6mPmQzxqGtdTPml/llfck7951ZIO5tOp
/NtGcfK7CsVERuIuRU59pil7myVMPAlsKbOas3AAAAAwEAAQAAAQAZUsC6Rt9aGxqYWVzi
/G+vFaTQWIS/rAo8QDfagqRtTxkAXpbtm90jQoXYCcOZIyr81lXr+8DGJ69uoRNvOVBQic
sXXypA4tjTJxUWXbc0aOqT5ObPZxAdcH5eWvg5cb1BQs6/VCsZGoAUbxQwa6N5nojYrxsg
UAY5zSfZxPJzgU4nK7RAq0OPbyDQ/oy6LdH2hzHRiU0mwMZlBc8nku6YhWLRE23wA+5+Rz
5eU/frrmWvDOjdw+XA8W72afkjdAxt41g0MC4/bVdipF/bpOPg/ypbqDHygHQqZgGPAXN+
86HkDc4uBrD4HA/iIURUztfqF9tE6A13Ofr83VnR+bOxAAAAgH9++uzkueJbh4xpbx5SW8
ZTsgH7kk17DZoIVCIm5qdfcdq4VPIWyepDw17EO1ZX4gRjzp9V7KYS7J24Qkn1je+MorDY
kG4Pz2IGuFdUT6TUx2+dQLzo8cl2B2hOYkjEALyhCWdT4m/CD0AmZJzthqPMzAl9IBu1Bg
XULuLsa/yFAAAAgQDxCIvJwpdGwQ31VGjl9hJ8WFTorLCbf74kxA/hrbjmz/k9pA+1Abxb
CWQ8EwiTRfHP/PR9E/3TtBgAwnyAcnuHccF+TwX2TFT/ELkUq4XM/NbRwIfNXXVX5AM9H/
bqz+ZkWmFlwQL5pGoooMjgo4FFc7vhbV+0vZ+lvj+hmxVZLwAAAIEAxm5LTWIEnmGnT2sp
6cctGFNal6YHZ5TOapNRhdUucBi0Tw72qz6+uOwLrrGEhqRAXk6pVUAT3jljP8pHwe4RYz
VZCC/sOlHpJ77ir18iUBejUOzEbmIaSG4i2h9RDzTmeoU2If2RF7+amNdR6UeHOvcyNz4m
krV+jnc4iDicvHkAAAAcYmhhbm90cEBiaGFub3RwLUMwMlo3ODIwTFZEUQECAwQFBgc=
-----END OPENSSH PRIVATE KEY-----
EOF

# Add e91user to the sudoers users to have permission to be root
echo "e91user  ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/e91user

# Install the public key for the default generated user
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC61HSwegJkMDSqYJRe6RuubC8XEJo+ymwx/EGrv0yg6YBQ6YeZfAeywUrqv8BzeKtNA5EOQY5zO2JeXkxDktHp/D4q4+P9Q9xSa4CLy7W1PyvMr9/Yvqc5DO8qUPDTAylTmyInkPGKaBIu1enLfJT5K48fNa87becYZFaKpJA5SsNhVkgAitc8bz7QrHs0fR0U2di0Ghps4KElTHyeMqYPJqDbb7XMvVGjPM+FedQTeV/girZOjtBMY1vALZSGG2xzvdEnFnT3OWt8hB6mPmQzxqGtdTPml/llfck7951ZIO5tOp/NtGcfK7CsVERuIuRU59pil7myVMPAlsKbOas3 >> /home/e91user/.ssh/id_rsa.pub

# Install the public keys for Pulkit, Andrew and Abid
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC61HSwegJkMDSqYJRe6RuubC8XEJo+ymwx/EGrv0yg6YBQ6YeZfAeywUrqv8BzeKtNA5EOQY5zO2JeXkxDktHp/D4q4+P9Q9xSa4CLy7W1PyvMr9/Yvqc5DO8qUPDTAylTmyInkPGKaBIu1enLfJT5K48fNa87becYZFaKpJA5SsNhVkgAitc8bz7QrHs0fR0U2di0Ghps4KElTHyeMqYPJqDbb7XMvVGjPM+FedQTeV/girZOjtBMY1vALZSGG2xzvdEnFnT3OWt8hB6mPmQzxqGtdTPml/llfck7951ZIO5tOp/NtGcfK7CsVERuIuRU59pil7myVMPAlsKbOas3 >> /home/e91user/.ssh/authorized_keys
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDA360+Cy5tW675l/EuvPoJXJHvzvy6ZBiztzlMwgarZSw6xXmHPmh8wHkbd2pHMRNjDr9Claxg6UxXu0CUKiiF7TDFxO3pC3O+fD5Y/e/WY1vMdvLq2qBYkkObr0aDrv356gjqrvARc6pYAap/faOUqwg4iEk4tgL6a1jptjOJIUVRchRT1XxPbHSvJDCIaQOYJyn06oFq14KHQk75/gxKjzQM6rQTqHcINgIBg14waa1vF6Vmdior4kGuydr62wbPlWqavVZblx/BeE1ugAeTXCs52Fcj2Z3xq0Zw9wGZKpoZt1rUhothlfQV9jp67lwp3BOE4qP9MDlkVuEkQMfL >> /home/e91user/.ssh/authorized_keys
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC99lJBOmgh4TjUYoaREscz0406v86m01Fbi5/GDsD2g1s1Wmhp/IxOx3ndsYcaTfj/1+6fACqwdT5/99r9SJl57XPyAS377rT8vJQkjOnSXoKNCnBmwh8HT4eJ9xU2C9nEHkOqchxp4KoCGhW9MtDhrPB9UYc7YR5pzjcgVTQx4wWO2rBbvfp3wyjmoRoaOQM1iEP0THyR36V8nZVPNH2LNqPryNiUbbIJLriiaPQdY2tsnYHBFcChpubntWkzs+K5woG3Jf5kzauUBBpweXpn7zWm0SxmMklm7jr5OboIRsm+NOTlWw4Xk2KdCD+oUImURA+TNKppefMIgvN3pHAJ >> /home/e91user/.ssh/authorized_keys
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDHrKM6Qvag+Snemu2v6SuxUyq9iIXQvY9PB5gCm8rW45gkAh3xTNGoB7t51X4NPvU5Y7YMxWBUQJXwPUXOhUUYTfMZ5cI9oaIijyLNLYwWPVtegMwwlcVYBzkES0P0mAtR6qHPaVE6Lj2vjWCkQwMLsYbsquzqezszwuv1DQRzzRkOiXE39h9IkhW3BduQaNrZQkJZJ2H0cpZkPXOfy631DQ1XuQ/UKT0U32HUA7Flhzrek8D1Xps/DE0AkxtIV0N9FEQHOO3bLKLE47RiUV4EfRSuroR+UWi+WQEnZfLtUNO5Xe1jhAartqxakN1D+/4pA/2ZUXect8Rw/QHcrxmT >> /home/e91user/.ssh/authorized_keys
chown -R e91user.e91user /home/e91user/.ssh
chmod 700 /home/e91user/.ssh
chmod 600 /home/e91user/.ssh/authorized_keys
hostnamectl set-hostname  production.cscie91.harvard.edu --static

# Setup the root user credentials and the private/public key 
mkdir -p /root/.ssh
chmod 700 /root/.ssh
cat > /root/.ssh/id_rsa << EOF
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAutR0sHoCZDA0qmCUXukbrmwvFxCaPspsMfxBq79MoOmAUOmHmXwH
ssFK6r/Ac3irTQORDkGOcztiXl5MQ5LR6fw+KuPj/UPcUmuAi8u1tT8rzK/f2L6nOQzvKl
Dw0wMpU5siJ5DximgSLtXpy3yU+SuPHzWvO23nGGRWiqSQOUrDYVZIAIrXPG8+0Kx7NH0d
FNnYtBoabOChJUx8njKmDyag22+1zL1RozzPhXnUE3lf4Iq2To7QTGNbwC2Uhhtsc73RJx
Z09zlrfIQepj5kM8ahrXUz5pf5ZX3JO/edWSDubTqfzbRnHyuwrFREbiLkVOfaYpe5slTD
wJbCmzmrNwAAA9jvC9ol7wvaJQAAAAdzc2gtcnNhAAABAQC61HSwegJkMDSqYJRe6RuubC
8XEJo+ymwx/EGrv0yg6YBQ6YeZfAeywUrqv8BzeKtNA5EOQY5zO2JeXkxDktHp/D4q4+P9
Q9xSa4CLy7W1PyvMr9/Yvqc5DO8qUPDTAylTmyInkPGKaBIu1enLfJT5K48fNa87becYZF
aKpJA5SsNhVkgAitc8bz7QrHs0fR0U2di0Ghps4KElTHyeMqYPJqDbb7XMvVGjPM+FedQT
eV/girZOjtBMY1vALZSGG2xzvdEnFnT3OWt8hB6mPmQzxqGtdTPml/llfck7951ZIO5tOp
/NtGcfK7CsVERuIuRU59pil7myVMPAlsKbOas3AAAAAwEAAQAAAQAZUsC6Rt9aGxqYWVzi
/G+vFaTQWIS/rAo8QDfagqRtTxkAXpbtm90jQoXYCcOZIyr81lXr+8DGJ69uoRNvOVBQic
sXXypA4tjTJxUWXbc0aOqT5ObPZxAdcH5eWvg5cb1BQs6/VCsZGoAUbxQwa6N5nojYrxsg
UAY5zSfZxPJzgU4nK7RAq0OPbyDQ/oy6LdH2hzHRiU0mwMZlBc8nku6YhWLRE23wA+5+Rz
5eU/frrmWvDOjdw+XA8W72afkjdAxt41g0MC4/bVdipF/bpOPg/ypbqDHygHQqZgGPAXN+
86HkDc4uBrD4HA/iIURUztfqF9tE6A13Ofr83VnR+bOxAAAAgH9++uzkueJbh4xpbx5SW8
ZTsgH7kk17DZoIVCIm5qdfcdq4VPIWyepDw17EO1ZX4gRjzp9V7KYS7J24Qkn1je+MorDY
kG4Pz2IGuFdUT6TUx2+dQLzo8cl2B2hOYkjEALyhCWdT4m/CD0AmZJzthqPMzAl9IBu1Bg
XULuLsa/yFAAAAgQDxCIvJwpdGwQ31VGjl9hJ8WFTorLCbf74kxA/hrbjmz/k9pA+1Abxb
CWQ8EwiTRfHP/PR9E/3TtBgAwnyAcnuHccF+TwX2TFT/ELkUq4XM/NbRwIfNXXVX5AM9H/
bqz+ZkWmFlwQL5pGoooMjgo4FFc7vhbV+0vZ+lvj+hmxVZLwAAAIEAxm5LTWIEnmGnT2sp
6cctGFNal6YHZ5TOapNRhdUucBi0Tw72qz6+uOwLrrGEhqRAXk6pVUAT3jljP8pHwe4RYz
VZCC/sOlHpJ77ir18iUBejUOzEbmIaSG4i2h9RDzTmeoU2If2RF7+amNdR6UeHOvcyNz4m
krV+jnc4iDicvHkAAAAcYmhhbm90cEBiaGFub3RwLUMwMlo3ODIwTFZEUQECAwQFBgc=
-----END OPENSSH PRIVATE KEY-----
EOF
chmod 600  /root/.ssh/id_rsa 
echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC61HSwegJkMDSqYJRe6RuubC8XEJo+ymwx/EGrv0yg6YBQ6YeZfAeywUrqv8BzeKtNA5EOQY5zO2JeXkxDktHp/D4q4+P9Q9xSa4CLy7W1PyvMr9/Yvqc5DO8qUPDTAylTmyInkPGKaBIu1enLfJT5K48fNa87becYZFaKpJA5SsNhVkgAitc8bz7QrHs0fR0U2di0Ghps4KElTHyeMqYPJqDbb7XMvVGjPM+FedQTeV/girZOjtBMY1vALZSGG2xzvdEnFnT3OWt8hB6mPmQzxqGtdTPml/llfck7951ZIO5tOp/NtGcfK7CsVERuIuRU59pil7myVMPAlsKbOas3 >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys
chown -R root.root /root/.ssh

# Install packages
yum update -y
# Install Docker and enable it to run at startup
yum install docker -y
systemctl enable docker
systemctl start docker

# Install git
yum install git -y
